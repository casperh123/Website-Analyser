@using WebsiteAnalyzer.Web.Models
@using WebsiteAnalyzer.Web.Components.ErrorHandling

@if (_open)
{
        
    <RadzenStack Gap="20" Style="max-width: 600px;">
        <RadzenText TextStyle="TextStyle.Subtitle1">Add new website</RadzenText>

        <RadzenTextBox @bind-Value="@_url" Placeholder="Url"/>
        <RadzenTextBox @bind-Value="@_name" Placeholder="Name"/>
        <RadzenButton Click="AddWebsite">Add</RadzenButton>
        <RadzenButton Click="@(() => _open = !_open)"
                      ButtonStyle="ButtonStyle.Danger">Cancel</RadzenButton>
    </RadzenStack>
    
    <ErrorMessage Message="@_message"></ErrorMessage>
}
else
{
    <RadzenButton Click="@(() => _open = !_open)">Add New</RadzenButton>
}

@code {
    [Parameter]
    public EventCallback<AddWebsiteModel> WebsiteAdded { get; set; }
    
    [Parameter]
    public bool StartOpen { get; set; }

    private bool _open;
    private string _url = "https://";
    private string _name;
    private string _message;

    protected override void OnInitialized()
    {
        _open = StartOpen;
    }

    private async Task AddWebsite()
    {
        _message = "";
        
        AddWebsiteModel newWebsite = new AddWebsiteModel(_name, _url);

        if (WebsiteAdded.HasDelegate)
        {
            try
            {
                await WebsiteAdded.InvokeAsync(newWebsite);
            }
            catch (Exception e)
            {
                _message = e.Message;
            }
        }

        _open = false;
    }
}